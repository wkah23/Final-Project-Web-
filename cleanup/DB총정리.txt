-- ★처음 필수 설정(C드라이브에 resource와 upload 폴더 추가

-- 기본 테이블
 CREATE TABLE BM_USER (
    ID NUMBER PRIMARY KEY,
    USERNAME VARCHAR2(100) NOT NULL,
    PASSWORD VARCHAR2(100) NOT NULL,
    EMAIL VARCHAR2(50) ,
    NICKNAME VARCHAR2(50),
    POINT NUMBER DEFAULT 0,
    PHONE VARCHAR2(20) ,
    RATING VARCHAR2(50) DEFAULT 0,
    ROLE VARCHAR2(20) DEFAULT 'ROLE_USER'
); 
    
    -- 유저 번호 자동증가    
    CREATE SEQUENCE USER_ID_SEQ
       INCREMENT BY 1
       START WITH 1
       MINVALUE 1
       MAXVALUE 99999999999
       NOCYCLE
       NOCACHE
       NOORDER;
 
 
create table bm_store (
    id NUMBER primary key,
    category number NOT NULL,
    store_name varchar2(100) NOT NULL,
    store_address1 varchar2(200) NOT NULL,
    store_address2 varchar2(200) NOT NULL,
    store_address3 varchar2(200),
    store_phone varchar2(20) NOT NULL,
    store_img varchar2(200),
    store_thumb varchar2(200),
    opening_time number DEFAULT 0,
    closing_time number DEFAULT 0,
    min_delevery number DEFAULT 0,
    delevery_time number DEFAULT 0,
    delevery_tip number  DEFAULT 0,
    store_des varchar2(1000) DEFAULT '가게소개가 없습니다'
);
 
    CREATE SEQUENCE STORE_ID_SEQ
       INCREMENT BY 1
       START WITH 1
       MINVALUE 1
       MAXVALUE 99999999999
       NOCYCLE
       NOCACHE
       NOORDER;
 
create table bm_food (
    id number primary key,
    store_id number NOT NULL,
    food_name varchar2(100) NOT NULL,
    food_price number NOT NULL,
    food_dec varchar2(200), 
    food_img varchar2(200),
    food_thumb varchar2(200)
);
 
    CREATE SEQUENCE FOOD_ID_SEQ
       INCREMENT BY 1
       START WITH 1
       MINVALUE 1
       MAXVALUE 99999999999
       NOCYCLE
       NOCACHE
       NOORDER;
       
ALTER TABLE BM_FOOD
ADD CONSTRAINT FOOD
FOREIGN KEY (STORE_ID)
REFERENCES BM_STORE(ID)
on delete cascade;
 
 
-- 음식 추가옵션
create table bm_food_option (
    id number PRIMARY KEY, 
    food_id number not null,
    option_name varchar2(100) not null,
    option_price number not null
);
 
    CREATE SEQUENCE OPTION_ID_SEQ
       INCREMENT BY 1
       START WITH 1
       MINVALUE 1
       MAXVALUE 99999999999
       NOCYCLE
       NOCACHE
       NOORDER;    
    
    
ALTER TABLE BM_FOOD_OPTION
ADD CONSTRAINT FOOD_OPTION
FOREIGN KEY (FOOD_ID)
REFERENCES BM_FOOD(ID)
on delete cascade;
 
 
 
-- 회원 주문정보 테이블
CREATE TABLE BM_ORDER_USER (
    ORDER_NUM NUMBER PRIMARY KEY,
    STORE_ID NUMBER NOT NULL,
    USER_ID NUMBER NOT NULL,
    ORDER_DATE TIMESTAMP DEFAULT SYSDATE,
    PAY_METHOD VARCHAR2(30),
    DELEVERY_STATUS VARCHAR2(50) DEFAULT '의뢰 대기중',
    PHONE VARCHAR2(20) NOT NULL,
    DELEVERY_ADDRESS1 NUMBER NOT NULL,
    DELEVERY_ADDRESS2 VARCHAR2(200) NOT NULL,
    DELEVERY_ADDRESS3 VARCHAR2(200),
    TOTAL_PRICE NUMBER NOT NULL,
    USED_POINT NUMBER DEFAULT 0,
    REQUEST VARCHAR2(2000),
    IMP_UID VARCHAR2(30) -- 아임포트 결제번호
);
 
 
CREATE TABLE BM_ORDER_DETAIL_USER (
    ORDER_NUM NUMBER,
    FOOD_INFO VARCHAR2(2000)
);
 
 
ALTER TABLE BM_ORDER_DETAIL_USER
ADD CONSTRAINT ORDER_DETAIL_USER
FOREIGN KEY (ORDER_NUM)
REFERENCES BM_ORDER_USER(ORDER_NUM)
on delete cascade;
 
 
 
 
 
 
-- 비회원 테이블
-- 회원 비회원 union all 하기위해 user_id 컬럼 추가
CREATE TABLE BM_ORDER_NON_USER (
    ORDER_NUM NUMBER PRIMARY KEY,
    STORE_ID NUMBER NOT NULL,
    USER_ID NUMBER NOT NULL,
    ORDER_DATE TIMESTAMP DEFAULT SYSDATE,
    PAY_METHOD VARCHAR2(30),
    DELEVERY_STATUS VARCHAR2(50) DEFAULT '의뢰 대기중',
    PHONE VARCHAR2(20) NOT NULL,
    DELEVERY_ADDRESS1 NUMBER NOT NULL,
    DELEVERY_ADDRESS2 VARCHAR2(200) NOT NULL,
    DELEVERY_ADDRESS3 VARCHAR2(200),
    TOTAL_PRICE NUMBER NOT NULL,
    USED_POINT NUMBER DEFAULT 0,
    REQUEST VARCHAR2(2000),
    IMP_UID VARCHAR2(30) -- 아임포트 결제번호
);
 
 
 
CREATE TABLE BM_ORDER_DETAIL_NON_USER (
    ORDER_NUM NUMBER,
    FOOD_INFO VARCHAR2(2000)
);
 
ALTER TABLE BM_ORDER_DETAIL_NON_USER
ADD CONSTRAINT ORDER_DETAIL_NON_USER
FOREIGN KEY (ORDER_NUM)
REFERENCES BM_ORDER_NON_USER(ORDER_NUM)
on delete cascade;
 
 
 
 
-- 포인트 테이블
CREATE TABLE BM_POINT (
    USER_ID NUMBER,
    USED_DATE TIMESTAMP DEFAULT SYSDATE,
    INFO VARCHAR2(100) NOT NULL,
    POINT NUMBER NOT NULL
);
 
ALTER TABLE BM_POINT
ADD CONSTRAINT POINT
FOREIGN KEY (USER_ID)
REFERENCES BM_USER(ID)
on delete cascade;
 
 
 
 
 
CREATE TABLE BM_REVIEW (
    ORDER_NUM NUMBER PRIMARY KEY,
    STORE_ID NUMBER NOT NULL,
    REVIEW_CONTENT VARCHAR2(3000) NOT NULL,
    BOSS_COMMENT VARCHAR2(3000),
    REGI_DATE TIMESTAMP DEFAULT SYSDATE,
    USER_ID NUMBER NOT NULL,
    SCORE NUMBER NOT NULL,
    REVIEW_IMG VARCHAR2(200) 
);
 
ALTER TABLE BM_REVIEW
ADD CONSTRAINT REVIEW
FOREIGN KEY (ORDER_NUM)
REFERENCES BM_ORDER_USER(ORDER_NUM)
on delete cascade;
 
 
 
 
-- 찜하기 테이블
CREATE TABLE BM_LIKES (
    USER_ID NUMBER,
    STORE_ID NUMBER,
    LIKES_DATE TIMESTAMP DEFAULT SYSDATE
);
 
ALTER TABLE BM_LIKES
ADD CONSTRAINT LIKES_USER_ID
FOREIGN KEY (USER_ID)
REFERENCES BM_USER(ID)
on delete cascade;
 
ALTER TABLE BM_LIKES
ADD CONSTRAINT LIKES_STORE_ID
FOREIGN KEY (STORE_ID)
REFERENCES BM_STORE(ID)
on delete cascade;
 
CREATE TABLE BM_POINT (
    USER_ID NUMBER,
    USED_DATE TIMESTAMP DEFAULT SYSDATE,
    INFO VARCHAR2(100) NOT NULL,
    USED_POINT NUMBER NOT NULL
);
 
 
CREATE TABLE BM_GIFT_CARD (
    GIFT_CARD_NUM VARCHAR2(50) PRIMARY KEY,
    POINT NUMBER NOT NULL,
    INFO VARCHAR2(100) NOT NULL
);

-- 내 가게 테이블 추가하기(관리자용 추가)
CREATE TABLE BM_MY_STORE (
    USER_ID NUMBER,
    STORE_ID NUMBER
);
 
ALTER TABLE BM_MY_STORE
ADD CONSTRAINT MY_STORE_U
FOREIGN KEY (USER_ID)
REFERENCES BM_USER(ID)
ON DELETE CASCADE;
 
 
ALTER TABLE BM_MY_STORE
ADD CONSTRAINT MY_STORE_S
FOREIGN KEY (STORE_ID)
REFERENCES BM_STORE(ID)
ON DELETE CASCADE;

-- 관리자 함수 (필수추가)
CREATE OR REPLACE FUNCTION GET_OPTION_SEQ
    RETURN NUMBER
IS
    SEQ NUMBER;
BEGIN
  SELECT OPTION_ID_SEQ.NEXTVAL INTO SEQ FROM DUAL;
RETURN SEQ;
END;

-- 오라클SQL 더미데이터 추가 목록

-- 1.세탁소 추가 DB ※우편번호가 0XXXX로 시작된다면 맨 앞의 0은 반드시 빼고 추가해야 한다.
INSERT INTO BM_STORE (ID, CATEGORY, STORE_NAME, STORE_ADDRESS1, STORE_ADDRESS2, STORE_ADDRESS3, STORE_PHONE, STORE_IMG, STORE_THUMB, OPENING_TIME, CLOSING_TIME,STORE_DES) VALUES (STORE_ID_SEQ.NEXTVAL, 100, '오늘은 빨래', '4020', '서울특별시 마포구 월드컵로5길 91 |', '서울특별시 마포구 합정동 395-6', '0507-1357-3087','/img/1.png','/img/1-1.png','0','24','오늘의 빨래가 유튜브 영상으로 소개되었습니다. https://youtu.be/9W4QXd2XZpQ');
INSERT INTO BM_STORE (ID, CATEGORY, STORE_NAME, STORE_ADDRESS1, STORE_ADDRESS2, STORE_ADDRESS3, STORE_PHONE, STORE_IMG, STORE_THUMB, OPENING_TIME, CLOSING_TIME,STORE_DES) VALUES (STORE_ID_SEQ.NEXTVAL, 100, '대우세탁소', '4073', '서울특별시 마포구 어울마당로1길 19 |', '서울특별시 마포구 합정동 358-12', '0507-1375-1554','/img/2.png','/img/2.png','8','22','세탁, 수선, 드라이크리닝, 운동화, 이불 세탁등 모든 세탁을 하고 있습니다. 배달도 하고 있으니 연락주세요.'); 
INSERT INTO BM_STORE (ID, CATEGORY, STORE_NAME, STORE_ADDRESS1, STORE_ADDRESS2, STORE_ADDRESS3, STORE_PHONE, STORE_IMG, STORE_THUMB, OPENING_TIME, CLOSING_TIME,STORE_DES) VALUES (STORE_ID_SEQ.NEXTVAL, 100, '매직크리닝고급세탁', '4020', '서울특별시 마포구 포은로 13 |', '서울특별시 마포구 합정동 396-1', '02-336-7492','/img/3.png','/img/3.png','8','20','10분내로 수거,배달 가능합니다. 원하시는 시간내에 배송 가능합니다. 언제든지 전화주세요!'); 
INSERT INTO BM_STORE (ID, CATEGORY, STORE_NAME, STORE_ADDRESS1, STORE_ADDRESS2, STORE_ADDRESS3, STORE_PHONE, STORE_IMG, STORE_THUMB, OPENING_TIME, CLOSING_TIME,STORE_DES) VALUES (STORE_ID_SEQ.NEXTVAL, 100, '화이트365', '4020', '서울특별시 마포구 월드컵로7길 103 |', '서울특별시 마포구 합정동 440-19', '010-8991-9235','/img/4.png','/img/4-1.png','0','24','믿을 수 있는 환경부 인증 친환경세제를 사용하는 국내 유일의 품질 1등급 인증매장! 국내 최고의 셀프빨래방입니다.'); 
INSERT INTO BM_STORE (ID, CATEGORY, STORE_NAME, STORE_ADDRESS1, STORE_ADDRESS2, STORE_ADDRESS3, STORE_PHONE, STORE_IMG, STORE_THUMB, OPENING_TIME, CLOSING_TIME,STORE_DES) VALUES (STORE_ID_SEQ.NEXTVAL, 100, '양지세탁', '3971', '서울특별시 마포구 월드컵로26길 48 101호 |', '서울특별시 마포구 성산동 250-3', '010-3349-7148','/img/5.png','/img/5.png','9','20','음식물, 와인, 혈흔, 흙탕물, 페인트, 기름얼룩, 오래된 얼룩, 황변제거 외 각종 얼룩제거와 일반세탁, 명품세탁, 가방, 운동화, 모자세탁 외 대부분 세탁이 가능합니다.'); 
INSERT INTO BM_STORE (ID, CATEGORY, STORE_NAME, STORE_ADDRESS1, STORE_ADDRESS2, STORE_ADDRESS3, STORE_PHONE, STORE_IMG, STORE_THUMB, OPENING_TIME, CLOSING_TIME,STORE_DES) VALUES (STORE_ID_SEQ.NEXTVAL, 100, '뽀송 유모차세탁', '4031', '서울특별시 마포구 양화로15안길 19 2층 |', '서울특별시 마포구 서교동 375-25', '0507-1380-9585','/img/6.png','/img/6.png','10','17','유모차와 카시트 소재 특성상 세탁 후 구김이 생길 수 있습니다. 참고하여 의뢰해주세요:)'); 
INSERT INTO BM_STORE (ID, CATEGORY, STORE_NAME, STORE_ADDRESS1, STORE_ADDRESS2, STORE_ADDRESS3, STORE_PHONE, STORE_IMG, STORE_THUMB, OPENING_TIME, CLOSING_TIME,STORE_DES) VALUES (STORE_ID_SEQ.NEXTVAL, 100, '버블맨24', '4059', '서울특별시 마포구 와우산로30길 3 |', '서울특별시 마포구 창전동 5-74','010-8694-9244','/img/7.png','/img/7-1.png','0','24','34키로 건조기, 운동화 세탁과 건조기 보유, 소량 의류세탁 건조를 위한 13키로 세탁기부터 이불 세탁을 위한 27키로 세탁까지! 또한 넓은 주자창도 있습니다.'); 
INSERT INTO BM_STORE (ID, CATEGORY, STORE_NAME, STORE_ADDRESS1, STORE_ADDRESS2, STORE_ADDRESS3, STORE_PHONE, STORE_IMG, STORE_THUMB, OPENING_TIME, CLOSING_TIME,MIN_DELEVERY, DELEVERY_TIME, DELEVERY_TIP, STORE_DES) VALUES (STORE_ID_SEQ.NEXTVAL, 100, '미영세탁', '4002', '서울특별시 마포구 동교로 125 1층 우측 2번째 |', '서울특별시 마포구 서교동 459-7', '02-336-3444','/img/8.png','/img/8.png','9','21','15000','2','-1000','항상 책임감을 가지고 깔끔하고 세심한 서비스로 보답하겠습니다.'); 
INSERT INTO BM_STORE (ID, CATEGORY, STORE_NAME, STORE_ADDRESS1, STORE_ADDRESS2, STORE_ADDRESS3, STORE_PHONE, STORE_IMG, STORE_THUMB, OPENING_TIME, CLOSING_TIME,STORE_DES) VALUES (STORE_ID_SEQ.NEXTVAL, 100, '현대세탁', '4016', '서울특별시 마포구 희우정로15길 5 |', '서울특별시 마포구 망원동 457-58','02-337-4739','/img/9.png','/img/9.png','8','21','현대세탁소입니다.'); 
INSERT INTO BM_STORE (ID, CATEGORY, STORE_NAME, STORE_ADDRESS1, STORE_ADDRESS2, STORE_ADDRESS3, STORE_PHONE, STORE_IMG, STORE_THUMB, OPENING_TIME, CLOSING_TIME,STORE_DES) VALUES (STORE_ID_SEQ.NEXTVAL, 100, '런드리익스프레스샵 연남점', '3983', '서울특별시 마포구 성미산로32길 13 |', '서울특별시 마포구 연남동 229-22','070-5118-0541','/img/10.png','/img/10-1.png','0','24','이토록 쉽고도 멋진 세탁 런드리 익스프레스입니다! 지구와 나를 위해 직접 제작한 식물 성분의 천연세제를 사용합니다. 세제와 유연제는 자동 투입됩니다.'); 
INSERT INTO BM_STORE (ID, CATEGORY, STORE_NAME, STORE_ADDRESS1, STORE_ADDRESS2, STORE_ADDRESS3, STORE_PHONE, STORE_IMG, STORE_THUMB, OPENING_TIME, CLOSING_TIME,STORE_DES) VALUES (STORE_ID_SEQ.NEXTVAL, 100, '막장세탁소', '4036', '서울특별시 어딘지 찾아봐랑 |', '어디있을까요~?','010-1234-5678','/img/11.png','/img/11.png','0','2','내가 운영하고 싶을때만 운영하는 막장 세탁소입니다.'); 

-- 2.미영세탁 기준 큰 서비스 DB : 실제 각자의 DB에 미영세탁ID를 7에 넣어야 한다.

INSERT INTO BM_FOOD (ID, STORE_ID, FOOD_NAME, FOOD_PRICE, FOOD_DEC, FOOD_IMG, FOOD_THUMB) 
VALUES (FOOD_ID_SEQ.NEXTVAL, 7, '남방 및 셔츠(배달비)', '1000', '남방 및 셔츠 관련된 세탁 요금입니다.', '/img/S1.png',  '/img/S1.png');

INSERT INTO BM_FOOD (ID, STORE_ID, FOOD_NAME, FOOD_PRICE, FOOD_DEC, FOOD_IMG, FOOD_THUMB) 
VALUES (FOOD_ID_SEQ.NEXTVAL, 7, '커버 및 이불(배달비)', '1000', '커버 및 이불 관련된 세탁 요금입니다.', '/img/S2.png',  '/img/S2.png');

INSERT INTO BM_FOOD (ID, STORE_ID, FOOD_NAME, FOOD_PRICE, FOOD_DEC, FOOD_IMG, FOOD_THUMB) 
VALUES (FOOD_ID_SEQ.NEXTVAL, 7, '점퍼(배달비)', '1000', '점퍼 관련된 세탁 요금입니다.', '/img/S3.png',  '/img/S3.png');

INSERT INTO BM_FOOD (ID, STORE_ID, FOOD_NAME, FOOD_PRICE, FOOD_DEC, FOOD_IMG, FOOD_THUMB) 
VALUES (FOOD_ID_SEQ.NEXTVAL, 7, '코트(배달비)', '1000', '코트 관련된 세탁 요금입니다.', '/img/S4.png',  '/img/S4.png');

INSERT INTO BM_FOOD (ID, STORE_ID, FOOD_NAME, FOOD_PRICE, FOOD_DEC, FOOD_IMG, FOOD_THUMB) 
VALUES (FOOD_ID_SEQ.NEXTVAL, 7, '기타(배달비)', '1000', '기타 세탁 요금입니다.', '/img/S5.png',  '/img/S5.png');

-- 3. 미영세탁 옵션 서비스 항목 DB 
-- 남방 및 셔츠 ID를 17에 적는다
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 17, '와이셔츠', 3000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 17, '남방', 4000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 17, '마셔츠', 4000);

-- 커버 및 이불 ID를 18에 적는다.
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 18, '일반 이불', 11000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 18, '극세사 이불', 13000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 18, '오리털 이불', 20000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 18, '양털 이불', 35000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 18, '침대 커버', 10000);

-- 점퍼 ID를 19에 적는다.
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 19, '정장 상하의 1벌', 10000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 19, '오리털 점퍼', 11000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 19, '가죽 점퍼', 30000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 19, '무스탕 재킷', 35000);

-- 코트 ID를 20에 적는다.
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 20, '오리털 코트', 13000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 20, '벤치다운 코트(검은색)', 15000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 20, '벤치다운 코트(그 외)', 16000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 20, '무스탕 반코트', 40000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 20, '모피 반코트', 50000);

-- 기타 ID를 21에 적는다.
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 21, '운동화', 6000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 21, '가죽장갑', 10000);
INSERT INTO BM_FOOD_OPTION VALUES (OPTION_ID_SEQ.NEXTVAL, 21, '러그', 23000);

-- 관리자 임명
update bm_user set role = 'ROLE_ADMIN' where username = '내 아이디 입력';
commit;

-- 가게 소유 임명, 10에는 유저id, 13에는 가게id
INSERT INTO BM_MY_STORE (USER_ID, STORE_ID) VALUES (유저아이디 숫자, 가게 아이디 숫자); 
COMMIT;

☆ DB를 통해 옵션 추가하는 방법
INSERT INTO BM_FOOD_OPTION 
	SELECT	GET_OPTION_SEQ(), 1, '옵션이름1', 500 
    UNION ALL
    SELECT	GET_OPTION_SEQ(), 2, '옵션이름2', 600
    UNION ALL
    SELECT	GET_OPTION_SEQ(), 1, '옵션이름3', 700 ...